<tal:cond condition="python:not view.is_anonymous">
  <script src="https://unpkg.com/htmx.org@1.9.10/dist/htmx.js"></script>
  <script type="text/javascript">
document.addEventListener("DOMContentLoaded", function() {
    /**
      Manage section size
      When changing the select, update the class of the parent element to resize the section
    */
    document.querySelectorAll(".edit-section-container form.edit-section-size").forEach(function(form) {
        form.addEventListener("htmx:afterRequest", function(event) {
            var response = JSON.parse(event.detail.xhr.response);
            if (!response.id) return;
            var parent = form.closest('.sortable-section');
            var lst_parent_classes = parent.className.split(" ");
            var new_parent_classes = "";
            var find = false;
            for (var i = 0; i < lst_parent_classes.length; i++) {
                if (lst_parent_classes[i].startsWith("col-")) {
                    find = true;
                    lst_parent_classes[i] = response.id;
                }
                new_parent_classes += " " + lst_parent_classes[i];
            }
            // "col-" can not be found if there is no section size defined
            if (!find) {
                new_parent_classes += " " + response.id;
            }
            parent.className = new_parent_classes.trim();
        });
    });
});
  </script>
</tal:cond>
