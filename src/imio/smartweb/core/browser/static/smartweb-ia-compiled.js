(()=>{function e(e,{anchorEl:t,onPick:n}){!function(){if(document.getElementById("sw-suggest-styles"))return;const e=document.createElement("style");e.id="sw-suggest-styles",e.textContent="\n  .sw-overlay{position:fixed;inset:0;background:rgba(0,0,0,.2);z-index:9999}\n  .sw-panel{position:fixed;max-width:480px;min-width:280px;max-height:60vh;overflow:auto;\n    background:#fff;border-radius:10px;box-shadow:0 12px 30px rgba(0,0,0,.25);padding:12px}\n  .sw-panel h3{margin:0 0 .5rem 0;font-size:1rem}\n  .sw-list{display:flex;flex-direction:column;gap:.5rem}\n  .sw-suggest-btn{display:block;width:100%;text-align:left;padding:.5rem .75rem;border-radius:8px;\n    border:1px solid #e5e7eb;background:#f9fafb;cursor:pointer;font:inherit}\n  .sw-suggest-btn:hover,.sw-suggest-btn:focus{background:#eef2ff;outline:none}\n  .sw-actions{display:flex;justify-content:flex-end;margin-top:.75rem}\n  .sw-cancel{border:1px solid #e5e7eb;background:#fff;border-radius:8px;padding:.4rem .7rem;cursor:pointer}\n  ",document.head.appendChild(e)}();const o=document.createElement("div");o.className="sw-overlay",o.setAttribute("role","presentation");const s=document.createElement("div");s.className="sw-panel",s.setAttribute("role","dialog"),s.setAttribute("aria-modal","true"),s.innerHTML='\n    <h3>Suggestions de titres</h3>\n    <div class="sw-list"></div>\n    <div class="sw-actions">\n      <button type="button" class="sw-cancel">Annuler</button>\n    </div>\n  ';const i=s.querySelector(".sw-list");e.forEach((e,t)=>{const o=document.createElement("button");o.type="button",o.className="sw-suggest-btn",o.textContent=e,o.addEventListener("click",()=>{"function"==typeof n&&n(e),a()}),i.appendChild(o)});const r=document.activeElement;function a(){document.removeEventListener("keydown",c),o.remove(),r&&"function"==typeof r.focus&&r.focus()}function c(e){"Escape"===e.key&&a()}document.addEventListener("keydown",c),o.addEventListener("click",e=>{e.target===o&&a()}),s.querySelector(".sw-cancel").addEventListener("click",a),o.appendChild(s),document.body.appendChild(o);const d=t.getBoundingClientRect();s.style.left="-9999px",s.style.top="-9999px",requestAnimationFrame(()=>{const e=Math.min(480,Math.max(280,Math.floor(.9*window.innerWidth)));s.style.maxWidth=e+"px";const t=Math.min(parseInt(getComputedStyle(s).maxHeight,10)||400,s.offsetHeight||400);let n=d.left,o=d.bottom+8;n+e>window.innerWidth-8&&(n=window.innerWidth-e-8),o+t>window.innerHeight-8&&(o=d.top-t-8),o<8&&(o=8),n<8&&(n=8),s.style.left=n+"px",s.style.top=o+"px";const i=s.querySelector(".sw-suggest-btn");i&&"function"==typeof i.focus&&i.focus()})}document.addEventListener("click",async t=>{const n=t.target.closest(".slug-generate-button");if(!n)return;t.preventDefault();const o=n.closest(".slugify-with-button, .pat-slugify-with-button");if(!o)return;const s=o.querySelector("input[type='text'], textarea");if(!s)return;const i=o.dataset.targetSelector||"",r=i?document.querySelector(i):s,a=o.dataset.slugUrl||"",c=tinymce.get("form-widgets-IRichTextBehavior-text").getContent(),d=o.closest("form")?.querySelector('input[name="_authenticator"]')?.value||"";try{n.disabled=!0;const t=await fetch(a,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8",Accept:"application/json","X-CSRF-TOKEN":d},body:new URLSearchParams({text:c}),credentials:"same-origin"});if(!t.ok){const e=await t.text();throw new Error(`HTTP ${t.status} – ${e}`)}const o=await t.json();if(console.log(o),Array.isArray(o.suggested_titles)&&o.suggested_titles.length)return void e(o.suggested_titles,{anchorEl:n,onPick:e=>{r.value=e,r.dispatchEvent(new Event("input",{bubbles:!0})),r.dispatchEvent(new Event("change",{bubbles:!0}))}})}catch(e){console.error("Slugify error:",e),alert("Erreur lors de la génération du slug.")}finally{n.disabled=!1}})})();